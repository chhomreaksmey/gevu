<html>
  <head>
    <meta charset="utf-8">
    <title>Carte sur l'âge des bâtiments au Havre</title>
    <script src="https://maps.googleapis.com/maps/api/js?v=3.exp&sensor=false&libraries=visualization"></script>
    <script type="text/javascript" src="../js/d3.v2.js"></script>
    <script type="text/javascript" src="../carto/legende_age.js"></script>
<big><b>Age des logements à la ville du Havre</b></big>
    <script>

    var n, map, pointarray, heatmap, map1, geocoder, adress;
	var Logements = [];

	  d3.json("../donnees_tables/gevulieux.json", function(json) {
		var nb = json.children.length
		for(var i=0;i<nb;i++){
			var item = json.children[i];
			Logements.push({location: new google.maps.LatLng(item.lat, item.lng), weight: item.value});
		}
		
        var mapOptions = {
          zoom: 11,
          center: new google.maps.LatLng(49.54403690, 0.13247040),
          mapTypeId: google.maps.MapTypeId.SATELLITE
        };

//AFFICHAGE DONNEES
function initialize1() {
  map1 = new GMap2(document.getElementById("map_canvas"));
  map1.setCenter(new GLatLng(49.54403690, 0.13247040), 11);
  map1.addControl(new GLargeMapControl);
  GEvent.addListener(map1, "click", getAddress);
  geocoder = new GClientGeocoder();
}


        map = new google.maps.Map(document.getElementById('map_canvas'),
            mapOptions);

        pointArray = new google.maps.MVCArray(Logements);

        heatmap = new google.maps.visualization.HeatmapLayer({
        	data: pointArray
        });

        heatmap.setMap(map);
        
	  });
	  
//affichage données	 
function getAddress(overlay, latlng) {
  if (latlng != null) {
    address = latlng;
    geocoder.getLocations(latlng, showAddress);
  }
}
//affichage données
function showAddress(response) {
  map1.clearOverlays();
  if (!response || response.Status.code != 200) {
    alert("Status Code:" + response.Status.code);
  } else {
    place = response.Placemark[0];
    point = new GLatLng(place.Point.coordinates[1],
                        place.Point.coordinates[0]);
    marker = new GMarker(point);
    map1.addOverlay(marker);
    marker.openInfoWindowHtml(
    '<b>orig latlng:</b>' + response.name + '<br/>' + 
    '<b>Latitude-Longitude:</b>' + place.Point.coordinates[1] + "," + place.Point.coordinates[0] + '<br>' +
    '<b>Addresse:</b>' + place.address + '<br>' +
    '<b>Code du Pays:</b> ' + place.AddressDetails.Country.CountryNameCode);
  }
}

      function toggleHeatmap() {
        heatmap.setMap(heatmap.getMap() ? null : map);
      }

      function changeGradient() {
        var gradient = [
          'rgba(0, 255, 255, 0)',
          'rgba(0, 255, 255, 1)',
          'rgba(0, 191, 255, 1)',
          'rgba(0, 127, 255, 1)',
          'rgba(0, 63, 255, 1)',
          'rgba(0, 0, 255, 1)',
          'rgba(0, 0, 223, 1)',
          'rgba(0, 0, 191, 1)',
          'rgba(0, 0, 159, 1)',
          'rgba(0, 0, 127, 1)',
          'rgba(63, 0, 91, 1)',
          'rgba(127, 0, 63, 1)',
          'rgba(191, 0, 31, 1)',
          'rgba(255, 0, 0, 1)'
        ]
        heatmap.setOptions({
          gradient: heatmap.get('gradient') ? null : gradient
        });
      }

      function changeRadius() {
        heatmap.setOptions({radius: heatmap.get('radius') ? null : 2});
      }

      function changeOpacity() {
        heatmap.setOptions({opacity: heatmap.get('opacity') ? null : 0.2});
      }
	  
// height : 600 width : 800 à remettre
    </script>
  </head>

  <body onload="initialize1">
    <div id="map_canvas" style="height: 600px; width: 800px;"></div>
    <button onclick="toggleHeatmap()">Toggle Heatmap</button>
    <button onclick="changeGradient()">Change gradient</button>
    <button onclick="changeRadius()">Change radius</button>
    <button onclick="changeOpacity()">Change opacity</button>
  </body>
</html>

<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8">
    <title>GEVU : Echelle logements du Havre</title>
	<link rel="stylesheet" href="../css/colorbrewer.css" />
    <script type="text/javascript" src="../js/colorbrewer.js"></script>
    <link type="text/css" rel="stylesheet" href="../css/button.css"/>
  </head>
  <body>
    <table>
    	<tr>
    		<td><div id="legende" ></div></td>
    	</tr>
    </table>
   <script type="text/javascript" src="../carto/legende_age.js"></script>
    <script type="text/javascript" >
    			getLegende();
	    </script>
  </body>
</html>

