<?xml version="1.0" encoding="utf-8"?>
<mx:Canvas label="Statistiques de diagnostic" xmlns:mx="http://www.adobe.com/2006/mxml" 
	creationComplete="init()"
	clipContent="false"
	>
	<mx:Script><![CDATA[
		[Embed(source="/images/A.png")] [Bindable] private var AIcon:Class;
		[Embed(source="/images/B.png")] [Bindable] private var BIcon:Class;
		[Embed(source="/images/C.png")] [Bindable] private var CIcon:Class;
		[Embed(source="/images/D.png")] [Bindable] private var DIcon:Class;
		[Embed(source="/images/E.png")] [Bindable] private var EIcon:Class;
		
		[Embed(source="/images/audio.jpg")] [Bindable] private var AudioIcon:Class;
		[Embed(source="/images/cog.jpg")] [Bindable] private var CogIcon:Class;
		[Embed(source="/images/moteur.jpg")] [Bindable] private var MoteurIcon:Class;
		[Embed(source="/images/visu.jpg")] [Bindable] private var VisuIcon:Class;

		private var handi:Object = 
			{ "A": {
				"color": 0xFF0000,
				"icon": AIcon,
				"markers": []}, 
				"B": {
					"color": 0x0000FF,
					"icon": BIcon,
					"markers": []},
				"C": {
					"color": 0x0000FF,
					"icon": CIcon,
					"markers": []},
				"D": {
					"color": 0x0000FF,
					"icon": DIcon,
					"markers": []},
				"E": {
					"color": 0x0000FF,
					"icon": EIcon,
					"markers": []}
			};

		[Bindable]	public var rsEtatDiag:Object;
		
		public function init():void {
			TraiteEtatDiag();
        }

		public function TraiteEtatDiag():void {
			
			//mise à jour du taux de calcul
			//TauxCalc.text = "Taux de calcul : "+rsEtatDiag.EtatDiag.TauxCalc;
			
			//mise à jour des icones handicateur
			for each (var obs:Object in rsEtatDiag)
			{
				if(obs.id=="moteur")
					imgAlphaMoteur.source=handi[obs.handi].icon;
				if(obs.id=="auditif")
					imgAlphaAudio.source=handi[obs.handi].icon;
				if(obs.id=="cognitif")
					imgAlphaCog.source=handi[obs.handi].icon;
				if(obs.id=="visuel")
					imgAlphaVisu.source=handi[obs.handi].icon;
			}

		}
			
		private function chartEtatDiagChange(event:Event):void {
			var allSeries:Array = event.currentTarget.series;
			var idDoc:String = "";
			var strHandi:String = "";
			var niv:String = "";
			var titreSelect:String = "";
			//construction de l'identifiant du doc
			//cf. library/php/ExeAjax.php?f=GetEtatDiagListe&id=5610&idDoc=0_audio
			/*
			for (var i:int=0; i<allSeries.length; i++) {
				chartTrace.text += "\n" + allSeries[i].id + 
					" Selected Items: " + allSeries[i].selectedIndices;
				//le type de handicap
				switch (allSeries[i].selectedIndices[0]) {
					case 0:
						strHandi = "_moteur";
						break;
					case 1:
						strHandi = "_audio";
						break;
					case 2:
						strHandi = "_cog";
						break;
					case 3:
						strHandi = "_visu";
						break;
				}				    
				//le niveau seulemet si on a récupéré  l'indice
				if(strHandi!="" && niv==""){
					switch (allSeries[i].id) {
						case "_gevu_ColumnSeries1":
							niv = "0";
							break;
						case "_gevu_ColumnSeries2":
							niv = "1";
							break;
						case "_gevu_ColumnSeries3":
							niv = "2";
							break;
						case "_gevu_ColumnSeries4":
							niv = "3";
							break;
					}
					//création du titre de la sélection
					titreSelect = allSeries[i].legendData[0].label;	
				}
			}
			
			idDoc = niv+strHandi; 
			//exécute la requête
			ShowListeDiag(idSite.text, idRub.text, idDoc, titreSelect);
			*/
		}

	]]></mx:Script>
	<!-- Define custom colors for use as fills. -->
	<mx:SolidColor id="sc0" color="green" alpha=".8"/>
	<mx:SolidColor id="sc1" color="yellow" alpha=".8"/>
	<mx:SolidColor id="sc2" color="#ffa200" alpha=".6"/>
	<mx:SolidColor id="sc3" color="red" alpha=".6"/>
	
	<!-- Define custom Strokes for the columns. -->
	<mx:Stroke id="s0" color="green" weight="2"/>
	<mx:Stroke id="s1" color="yellow" weight="2"/>
	<mx:Stroke id="s2" color="#ffa200" weight="2"/>
	<mx:Stroke id="s3" color="red" weight="2"/>

	<mx:VBox label="Diagnostic" height="300" >
		<mx:HBox paddingLeft="70" visible="false" height="0" >
			<mx:Label id="TauxCalc" />
			<mx:Image id="imgMoteur" source="{MoteurIcon}" width="60" />
			<mx:Image id="imgAudio" source="{AudioIcon}" width="60" />
			<mx:Image id="imgCog" source="{CogIcon}" width="60" />
			<mx:Image id="imgVisu" source="{VisuIcon}" width="60" />
		</mx:HBox>
		
		<mx:ColumnChart id="chart" 
						dataProvider="{rsEtatDiag}" 
						type="stacked"
						showDataTips="true" 
						change="chartEtatDiagChange(event)"
						selectionMode="multiple"
						width="320" height="200"
						>
			<mx:horizontalAxis>
				<mx:CategoryAxis id="h1" categoryField="id" />
			</mx:horizontalAxis>
			<mx:series>
				<mx:ColumnSeries 
					xField="id" 
					yField="niv0" 
					displayName="Critères valides"
					fill="{sc0}"
					stroke="{s0}"
					selectable="true"
					/>
				<mx:ColumnSeries 
					xField="id" 
					yField="niv1" 
					displayName="Obstacles niveau 1"
					fill="{sc1}"
					stroke="{s1}"
					/>
				<mx:ColumnSeries 
					xField="id" 
					yField="niv2" 
					displayName="Obstacles niveau 2"
					fill="{sc2}"
					stroke="{s2}"
					/>
				<mx:ColumnSeries 
					xField="id" 
					yField="niv3" 
					displayName="Obstacles niveau 3"
					fill="{sc3}"
					stroke="{s3}"
					/>
			</mx:series>
		</mx:ColumnChart>
		<mx:HBox paddingLeft="54" >
			<mx:Image id="imgAlphaMoteur" source="{AIcon}" width="60" />
			<mx:Image id="imgAlphaAudio" source="{BIcon}" width="60" />
			<mx:Image id="imgAlphaCog" source="{CIcon}" width="60" />
			<mx:Image id="imgAlphaVisu" source="{DIcon}" width="60" />		
		</mx:HBox>
		<mx:Legend visible="false"  height="0" >
			<mx:HBox>
				<mx:LegendItem label="valides" fill="{sc0}" stroke="{s0}" />			
				<mx:LegendItem label="niveau 1" fill="{sc1}" stroke="{s1}" />
				<mx:LegendItem label="niveau 2" fill="{sc2}" stroke="{s2}" />
				<mx:LegendItem label="niveau 3" fontWeight="bold" fill="{sc3}" stroke="{s3}" />
			</mx:HBox>
		</mx:Legend>
	</mx:VBox>
	

	
</mx:Canvas>
