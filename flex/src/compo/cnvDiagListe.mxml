<?xml version="1.0" encoding="utf-8"?>
<mx:VBox xmlns:mx="http://www.adobe.com/2006/mxml" width="100%" height="100%" 
    creationComplete="init();"  > 
            
	<mx:Script>
        <![CDATA[
			import compo.form.affirmations;
			
			import mx.collections.ArrayCollection;
			import mx.controls.Alert;
			import mx.controls.Image;
			import mx.managers.CursorManager;
			import mx.managers.PopUpManager;
			import mx.rpc.events.FaultEvent;
			import mx.rpc.events.ResultEvent;
            private var titreListeDiag:String;
			public var params:Array;
			public var mainCtrlWidth:int;

			private function init():void{
				roDiag.getDiagListe(params,this.parentApplication.idBase);
				setStyleListeDiag();
				if(mainCtrlWidth)mainCtrl.width = mainCtrlWidth;
			}
			
			public function setStyleListeDiag():void{
				switch(params['niv']) {
		            case "0":
						lblTitre.text = "Critères "+params['handi']+"s valides";
						mainCtrl.setStyle("borderColor","green");
						mainCtrl.setStyle("backgroundColor","green");
		                break;
		            case "1":
						lblTitre.text = "Gène "+params['handi']+"s mineure";
						mainCtrl.setStyle("borderColor","yellow");
						mainCtrl.setStyle("backgroundColor","yellow");
		                break;
		            case "2":
						lblTitre.text = "Gène "+params['handi']+"s intermédiaire";
						mainCtrl.setStyle("borderColor","#ffa200");
						mainCtrl.setStyle("backgroundColor","#ffa200");
		                break;
		            case "3":
						lblTitre.text = "Gène "+params['handi']+"s majeure";
						mainCtrl.setStyle("borderColor","red");
						mainCtrl.setStyle("backgroundColor","red");
		                break;
		        } 
				//lblTitre.text += " "+titreListeDiag;
			}	
			
			private function faultHandlerService(fault:FaultEvent, os:String=""):void {
				var str:String;
				str = "Code: "+fault.fault.faultCode.toString()+"\n"+
					"Detail: "+fault.fault.faultDetail.toString()+"\n"+
					"String: "+fault.fault.faultString.toString()+"\n";
				
				if (os!="")
					os = " - "+os;
				Alert.show(str, "FaultHandlerService"+os);
			}
			
			
			protected function getDiagListe_resultHandler(event:ResultEvent):void
			{
				if(event.result=="") return;
				var rsListe:Object = event.result;
								
				//boucle sur les critères
				for each (var rLieu:Object in rsListe)
				{
					var vb:VBox = new VBox;
					//vb.percentHeight = 100;
					vb.percentWidth = 100;
					var ar:ariane = new ariane;
					ar.NodeData = rLieu["ariane"]["id"][0]["ariane"];
					vb.addChild(ar);
					var af:affirmations = new affirmations;
					af.NodeData = rLieu;
					vb.addChild(af);
					mainCtrl.addChild(vb);	
				}

				
			}
        ]]>
    </mx:Script>
	<mx:RemoteObject id="roDiag"
					 destination="zend"
					 source="GEVU_Diagnostique"
					 fault="faultHandlerService(event, 'GEVU - Diagnostic');"
					 showBusyCursor="true"
					 >
		<mx:method name="getDiagListe" result="getDiagListe_resultHandler(event)" />
	</mx:RemoteObject>	

	<mx:VBox id="mainCtrl" width="100%" height="100%">
		<mx:Label id="lblTitre" fontSize="18" />
	</mx:VBox>
</mx:VBox>
