<?xml version="1.0" encoding="utf-8"?>
<mx:TitleWindow xmlns:mx="http://www.adobe.com/2006/mxml" layout="absolute" width="100%" height="100%"
	title="Authentification"
	close="PopUpManager.removePopUp(this);"  
	xmlns:ns2="compo.*" 
	>
	<mx:Script>
        <![CDATA[
	       	import mx.managers.PopUpManager;
			import mx.managers.CursorManager;
			import mx.core.Application;
			import mx.controls.Alert;

			import mx.rpc.AsyncToken;
			import mx.rpc.events.FaultEvent;
			import mx.rpc.events.ResultEvent;
			import mx.rpc.http.HTTPService;


			[Bindable] public var colorTheme:uint= 0xCCB5A3;
			[Bindable] public var endPoint:String;
			
			private function VerifMdp():void{
				
				var p:Object=new Object;
				p['username']=log.text;
				p['password']=mdp.text;
				LoginService.verifyUser(p);				
			}

			public function faultHandlerService(fault:FaultEvent):void
			{
				Alert.show(fault.fault.faultCode.toString(), "FaultHandlerService");
			}
			 
			public function resultHandlerService(result:ResultEvent):void
			{
				
				if(result.result == "FAILURE_CREDENTIAL_INVALID") {
					Alert.show("Ce n'est pas le bon mot de passe", 'Vérification mot de passe', mx.controls.Alert.OK);
					return;
				}
				if(result.result.idExi==null){
					Alert.show("Ce login n'est pas dans la base.\nVous êtes connecté comme invité.", 'Vérification authentification', mx.controls.Alert.OK);
				}else{
					this.parentApplication.exi = result.result;
				}	
				PopUpManager.removePopUp(this);
			}      
			
        ]]>
    </mx:Script>
	<mx:RemoteObject
		id="LoginService"
		destination="zend"
	   	endpoint="{endPoint}"
	   	fault="faultHandlerService(event)"
		source="AUTH_LoginManager" showBusyCursor="true">
		<mx:method name="verifyUser"   result="resultHandlerService(event)" />
	</mx:RemoteObject>

	<mx:VBox paddingTop="6" paddingBottom="6" paddingLeft="6" paddingRight="6"  >		
		<mx:HBox>
			<mx:Label text="Login : " />
			<mx:TextInput id="log" />
		</mx:HBox>
		<mx:HBox>
			<mx:Label text="Mot de passe : " />
			<mx:TextInput id="mdp" displayAsPassword="true" />
		</mx:HBox>
		<mx:Button label="Valider" click="VerifMdp()" />
	</mx:VBox>
</mx:TitleWindow>
